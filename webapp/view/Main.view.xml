<mvc:XMLView
    controllerName="logaligroup.mapeobapi.controller.Main"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:m="sap.m"
    xmlns:f="sap.f"
    xmlns:core="sap.ui.core"
    xmlns:layout="sap.ui.layout.form"
>
    <m:Shell>
        <f:DynamicPage
            id="dynamicPage"
            headerExpanded="true"
            showFooter="false"
            backgroundDesign="Solid"
        >
            <f:title>
                <f:DynamicPageTitle>
                    <f:heading>
                        <m:Title
                            text="Gestión de Movimientos de Mercancías"
                            level="H1"
                        />
                    </f:heading>
                    <f:actions>
                        <m:Button
                            icon="sap-icon://log"
                            text="Salir"
                            type="Reject"
                            press="onExit"
                        />
                    </f:actions>
                </f:DynamicPageTitle>
            </f:title>
            <f:content>
                <m:IconTabBar
                    id="mainTabBar"
                    select="onTabSelect"
                    backgroundDesign="Solid"
                >
                    <m:items>
                        <m:IconTabFilter text="Datos de Cabecera">
                            <m:VBox
                                width="100%"
                                fitContainer="true"
                            >
                                <layout:SimpleForm
                                    editable="true"
                                    layout="ResponsiveGridLayout"
                                    labelSpanL="4"
                                    labelSpanM="4"
                                    labelSpanS="12"
                                    emptySpanL="0"
                                    emptySpanM="0"
                                    emptySpanS="0"
                                    columnsL="1"
                                    columnsM="1"
                                    backgroundDesign="Translucent"
                                >
                                    <m:Label
                                        text="Salida de Mercancía"
                                        design="Bold"
                                    />
                                    <m:Select
                                        id="referenceType"
                                        change="onReferenceTypeChange"
                                        selectedKey="{mainModel>/header/reference_type}"
                                    >
                                        <core:Item
                                            key=""
                                            text="Selecciona..."
                                        />
                                        <core:Item
                                            key="reserva"
                                            text="Reserva"
                                        />
                                        <core:Item
                                            key="orden"
                                            text="Orden"
                                        />
                                        <core:Item
                                            key="otro"
                                            text="Otro"
                                        />
                                    </m:Select>
                                    <m:Label
                                        text="Clase de Movimiento"
                                        design="Bold"
                                    />
                                    <m:Input
                                        id="moveTypeManual"
                                        value="{mainModel>/header/move_type}"
                                        editable="{= ${mainModel>/header/reference_type} === 'otro' }"
                                        type="Text"
                                    />
                                    <m:Label
                                        text="Fecha Documento"
                                        design="Bold"
                                    />
                                    <m:DatePicker
                                        id="docDate"
                                        value="{mainModel>/header/doc_date}"
                                    />
                                    <m:Label
                                        text="Fecha Contabilización"
                                        design="Bold"
                                    />
                                    <m:DatePicker
                                        id="pstngDate"
                                        value="{mainModel>/header/pstng_date}"
                                    />
                                    <m:Label
                                        text="Referencia"
                                        design="Bold"
                                    />
                                    <m:Input
                                        id="refDocNo"
                                        value="{mainModel>/header/ref_doc_no}"
                                        placeholder="Ej. 500"
                                        type="Text"
                                    />
                                    <m:Label
                                        text="Texto Cabecera"
                                        design="Bold"
                                    />
                                    <m:TextArea
                                        id="headerTxt"
                                        value="{mainModel>/header/header_txt}"
                                        rows="3"
                                        growing="true"
                                    />
                                </layout:SimpleForm>
                                <m:HBox
                                    justifyContent="End"
                                    width="100%"
                                    class="sapUiSmallMarginTop"
                                >
                                    <m:Button
                                        text="Guardar"
                                        type="Accept"
                                        press="onSaveHeader"
                                        icon="sap-icon://save"
                                    />
                                    <m:Button
                                        text="Cancelar"
                                        type="Reject"
                                        press="onCancelHeader"
                                        icon="sap-icon://decline"
                                    />
                                </m:HBox>
                            </m:VBox>
                        </m:IconTabFilter>
                        <m:IconTabFilter text="Datos de Posición">
                            <m:VBox
                                width="100%"
                                fitContainer="true"
                            >
                                <layout:SimpleForm
                                    editable="true"
                                    layout="ResponsiveGridLayout"
                                    title="Datos de Posición"
                                    labelSpanL="4"
                                    labelSpanM="4"
                                    labelSpanS="12"
                                    emptySpanL="0"
                                    emptySpanM="0"
                                    emptySpanS="0"
                                    columnsL="1"
                                    columnsM="1"
                                    backgroundDesign="Translucent"
                                >
                                    <m:Label
                                        text="Material"
                                        design="Bold"
                                    />
                                    <m:Input
                                        id="material"
                                        value="{mainModel>/currentItem/material}"
                                        submit="onMaterialScanned"
                                        placeholder="Escanea o ingresa el material"
                                        type="Text"
                                    />
                                    <m:Label
                                        text="Cantidad"
                                        design="Bold"
                                    />
                                    <m:Input
                                        id="entryQnt"
                                        value="{mainModel>/currentItem/entry_qnt}"
                                        type="Number"
                                    />
                                    <m:Label
                                        text="UM"
                                        design="Bold"
                                    />
                                    <m:Input
                                        id="entryUom"
                                        value="{mainModel>/currentItem/entry_uom}"
                                        type="Text"
                                    />
                                    <m:Label
                                        text="Lote"
                                        design="Bold"
                                    />
                                    <m:Input
                                        id="batch"
                                        value="{mainModel>/currentItem/batch}"
                                        type="Text"
                                    />
                                    <m:Label
                                        text="Centro"
                                        design="Bold"
                                    />
                                    <m:Input
                                        id="plant"
                                        value="{mainModel>/currentItem/plant}"
                                        type="Text"
                                    />
                                    <m:Label
                                        text="Almacén"
                                        design="Bold"
                                    />
                                    <m:Input
                                        id="stgeLoc"
                                        value="{mainModel>/currentItem/stge_loc}"
                                        type="Text"
                                    />
                                    <m:Label
                                        text="Centro de Costo"
                                        design="Bold"
                                    />
                                    <m:Input
                                        id="costcenter"
                                        value="{mainModel>/currentItem/costcenter}"
                                        visible="{= ${mainModel>/savedHeader/move_type} === '201' || ${mainModel>/savedHeader/move_type} === '551' }"
                                        type="Text"
                                    />
                                    <m:Label
                                        text="Orden de Compra"
                                        design="Bold"
                                    />
                                    <m:Input
                                        id="orderid"
                                        value="{mainModel>/currentItem/orderid}"
                                        visible="{= ${mainModel>/savedHeader/move_type} === '261' }"
                                        type="Text"
                                    />
                                    <m:Label
                                        text="Motivo"
                                        design="Bold"
                                    />
                                    <m:Input
                                        id="moveReas"
                                        value="{mainModel>/currentItem/move_reas}"
                                        visible="{= ${mainModel>/savedHeader/move_type} === '551' }"
                                        showValueHelp="true"
                                        valueHelpRequest="onMoveReasValueHelp"
                                        type="Text"
                                    />
                                    <m:Label
                                        text="Reserva No"
                                        design="Bold"
                                    />
                                    <m:Input
                                        id="reservNo"
                                        value="{mainModel>/currentItem/reserv_no}"
                                        visible="{= ${mainModel>/savedHeader/move_type} === '201' }"
                                        type="Text"
                                    />
                                    <m:Label
                                        text="Ítem Reserva"
                                        design="Bold"
                                    />
                                    <m:Input
                                        id="resItem"
                                        value="{mainModel>/currentItem/res_item}"
                                        visible="{= ${mainModel>/savedHeader/move_type} === '201' }"
                                        type="Text"
                                    />
                                    <m:Label
                                        text="Texto Posición"
                                        design="Bold"
                                    />
                                    <m:TextArea
                                        id="positionTxt"
                                        value="{mainModel>/currentItem/position_txt}"
                                        rows="3"
                                        growing="true"
                                    />
                                </layout:SimpleForm>
                                <m:HBox
                                    justifyContent="End"
                                    width="100%"
                                    class="sapUiSmallMarginTop"
                                >
                                    <m:Button
                                        text="Escanear"
                                        type="Emphasized"
                                        press="onScanMaterial"
                                        icon="sap-icon://bar-code"
                                    />
                                    <m:Button
                                        text="Guardar"
                                        type="Accept"
                                        press="onSaveItem"
                                        icon="sap-icon://save"
                                    />
                                    <m:Button
                                        text="Cancelar"
                                        type="Reject"
                                        press="onCancelItem"
                                        icon="sap-icon://decline"
                                    />
                                </m:HBox>
                            </m:VBox>
                        </m:IconTabFilter>
                        <m:IconTabFilter
                            text="Orden Completa"
                            iconColor="Neutral"
                        >
                            <m:VBox
                                width="100%"
                                class="sapUiContentPadding"
                            >
                                <layout:SimpleForm
                                    editable="false"
                                    layout="ResponsiveGridLayout"
                                    labelSpanL="4"
                                    labelSpanM="4"
                                    labelSpanS="12"
                                    columnsL="1"
                                    columnsM="1"
                                    adjustLabelSpan="false"
                                    emptySpanL="1"
                                    emptySpanM="1"
                                    emptySpanS="0"
                                    width="100%"
                                    backgroundDesign="Translucent"
                                >
                                    <m:Label
                                        text="Operación de Almacén"
                                        design="Bold"
                                    />
                                    <m:Text
                                        text="{mainModel>/savedHeader/reference_type}"
                                        wrapping="true"
                                        textAlign="Center"
                                    />
                                    <m:Label
                                        text="Fecha Documento"
                                        design="Bold"
                                    />
                                    <m:Text
                                        text="{path: 'mainModel>/savedHeader/doc_date', formatter: '.formatDate'}"
                                        wrapping="true"
                                        textAlign="Center"
                                    />
                                    <m:Label
                                        text="Fecha Contabilización"
                                        design="Bold"
                                    />
                                    <m:Text
                                        text="{path: 'mainModel>/savedHeader/pstng_date', formatter: '.formatDate'}"
                                        wrapping="true"
                                        textAlign="Center"
                                    />
                                    <m:Label
                                        text="Documento Referencia"
                                        design="Bold"
                                    />
                                    <m:Text
                                        text="{mainModel>/savedHeader/ref_doc_no}"
                                        wrapping="true"
                                        textAlign="Center"
                                    />
                                    <m:Label
                                        text="Texto Cabecera"
                                        design="Bold"
                                    />
                                    <m:Text
                                        text="{mainModel>/savedHeader/header_txt}"
                                        wrapping="true"
                                        textAlign="Center"
                                    />
                                </layout:SimpleForm>
                                <m:ToolbarSpacer />
                                <m:Label
                                    text="Total de Ítems"
                                    design="Bold"
                                />
                                <m:Text
                                    text="{mainModel>/itemCount}"
                                    wrapping="true"
                                    textAlign="Center"
                                />
                                <m:Table
                                    id="itemsTable"
                                    items="{path: 'mainModel>/items', parameters: {array: true}}"
                                    width="100%"
                                    class="sapUiSmallMarginTop"
                                    backgroundDesign="Translucent"
                                >
                                    <m:columns>
                                        <m:Column
                                            demandPopin="true"
                                            minScreenWidth="Tablet"
                                        >
                                            <m:Text text="Material" />
                                        </m:Column>
                                        <m:Column
                                            demandPopin="true"
                                            minScreenWidth="Tablet"
                                        >
                                            <m:Text text="Cantidad" />
                                        </m:Column>
                                        <m:Column
                                            demandPopin="true"
                                            minScreenWidth="Tablet"
                                        >
                                            <m:Text text="UM" />
                                        </m:Column>
                                        <m:Column
                                            demandPopin="true"
                                            minScreenWidth="Tablet"
                                        >
                                            <m:Text text="Lote" />
                                        </m:Column>
                                        <m:Column
                                            demandPopin="true"
                                            minScreenWidth="Tablet"
                                        >
                                            <m:Text text="Centro" />
                                        </m:Column>
                                        <m:Column
                                            demandPopin="true"
                                            minScreenWidth="Tablet"
                                        >
                                            <m:Text text="Almacén" />
                                        </m:Column>
                                        <m:Column
                                            demandPopin="true"
                                            minScreenWidth="Tablet"
                                        >
                                            <m:Text text="Centro de Costo" />
                                        </m:Column>
                                        <m:Column
                                            demandPopin="true"
                                            minScreenWidth="Tablet"
                                        >
                                            <m:Text text="Motivo" />
                                        </m:Column>
                                        <m:Column>
                                            <m:Text text="Eliminar" />
                                        </m:Column>
                                    </m:columns>
                                    <m:items>
                                        <m:ColumnListItem>
                                            <m:cells>
                                                <m:Text
                                                    text="{mainModel>material}"
                                                />
                                                <m:Text
                                                    text="{mainModel>entry_qnt}"
                                                />
                                                <m:Text
                                                    text="{mainModel>entry_uom}"
                                                />
                                                <m:Text
                                                    text="{mainModel>batch}"
                                                />
                                                <m:Text
                                                    text="{mainModel>plant}"
                                                />
                                                <m:Text
                                                    text="{mainModel>stge_loc}"
                                                />
                                                <m:Text
                                                    text="{mainModel>costcenter}"
                                                />
                                                <m:Text
                                                    text="{mainModel>move_reas}"
                                                />
                                                <m:Button
                                                    icon="sap-icon://delete"
                                                    type="Reject"
                                                    tooltip="Eliminar"
                                                    press="onDeleteItem"
                                                />
                                            </m:cells>
                                        </m:ColumnListItem>
                                    </m:items>
                                </m:Table>
                                <m:HBox
                                    justifyContent="End"
                                    width="100%"
                                    class="sapUiSmallMarginTop"
                                >
                                    <m:Button
                                        text="Submit"
                                        type="Accept"
                                        icon="sap-icon://accept"
                                        press="onSubmit"
                                    />
                                </m:HBox>
                            </m:VBox>
                        </m:IconTabFilter>
                    </m:items>
                </m:IconTabBar>
            </f:content>
        </f:DynamicPage>
    </m:Shell>
</mvc:XMLView>